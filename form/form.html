<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Detalles de la tarea</title>
<link rel="stylesheet" type="text/css" href="view.css" media="all">
<script type="text/javascript" src="../trellocaller4.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body id="main_body" >
	
	<img id="top" src="top.png" alt="">
	<div id="form_container">
	
		<h1><a>Detalles de la tarea</a></h1>
		<form id="form_47948" class="appnitro"  method="POST" action="">
					<div class="form_description">
			<h2>Detalles de la tarea</h2>
			<p>Introduce los detalles de la tarea a generar en Trello</p>
		</div>						
			<ul >
			
					<li id="li_2" >
		<label class="description" for="element_2">Tipo de Entrega </label>
		<div>
		<select class="element select medium" id="element_2" name="element_2"> 
			<option value="" selected="selected"></option>
<option value="1" >Correctivo</option>
<option value="2" >Adaptivo</option>

		</select>
		</div><p class="guidelines" id="guide_2"><small>Elige el tipo de </small></p> 
		</li>		<li id="li_1" >
		<label class="description" for="element_1">Tarea Omnia Manager </label>
		<div>
			<input id="element_1" name="element_1" class="element text small" type="text" maxlength="255" value=""/> 
		</div><p class="guidelines" id="guide_1"><small>ID de la tarea para imputar en Omnia Manager</small></p> 
		</li>
		<label class="description" for="element_3">Estimación </label>
		<div>
			<input id="element_3" name="element_3" class="element text small" type="text" maxlength="255" value=""/> 
		</div><p class="guidelines" id="guide_1"><small>Estimación de la tarea</small></p> 
		</li>
			
					<li class="buttons">
			    <input type="hidden" name="form_id" value="47948" />
				<input type="hidden" name="key" id="keyfield" value=""/>
				<input type="hidden" name="token" id="tokenfield" value=""/>
				<input type="hidden" name="CT" id="CTfield" value=""/>
				<input id="saveForm" class="button_text" name="submit" value="Submit" type="button" onclick="evaluatevalues()"/>
		</li>
			</ul>
		</form>	
	</div>
	<img id="bottom" src="bottom.png" alt="">
	<script> 
		{
			window.onload = load;
			function load() {
				var keyvalue = getUrlVars()["key"];
				var tokenvalue = getUrlVars()["token"];
				var CTaux = getUrlVars()["CT"];
				var CTaux1 = decodeURIComponent(CTaux);
				var CTarray= CTaux1.split("/ITDQACT-");
				var CTvalue="ITDQACT-"+CTarray[1];
				document.getElementById("keyfield").setAttribute('value', keyvalue);
				document.getElementById("tokenfield").setAttribute('value', tokenvalue);
				document.getElementById("CTfield").setAttribute('value', CTvalue);
				CTvalorhidden=document.getElementById('CTfield').value;
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "https://jira.euipoqaportal.eu/jira/rest/api/2/issue/"+CTvalorhidden, false);
    //xhr.setRequestHeader("Content-Type", "text/html;charset=UTF-8");
    xhr.send()
    //console.log(xhr.responseText);
    //console.log(xhr.readyState);
    //console.log(xhr.status);
    var jsonvalue = JSON.parse(xhr.responseText);
    var controltable = jsonvalue['key'];
    var Application = jsonvalue['fields']['customfield_10476']['value'];
    var Version	= jsonvalue['fields']['customfield_10361'];	
    var RC= jsonvalue['fields']['customfield_10363'];			
    var Clarity	= jsonvalue['fields']['customfield_10806'];	
    var Business= jsonvalue['fields']['customfield_11408'];
    var Type= jsonvalue['fields']['type']['name'];		
    var Status= jsonvalue['fields']['status']['name'];		
    var PM = jsonvalue['fields']['customfield_10373']['displayName'];	
    var Planneddel = jsonvalue['fields']['customfield_10476'];	
    var PlannedUAT= jsonvalue['fields']['customfield_10377'];	
    var PlannedGL= jsonvalue['fields']['customfield_10366'];	
    var Description = jsonvalue['fields']['description'];
    var Folder	= jsonvalue['fields']['customfield_10392']['value'];	
    console.log("controltable :" + controltable );
    console.log("Application  :" + Application  );
    console.log("Version	  :" + Version	    );
    console.log("RC           :" + RC           );
    console.log("Clarity	  :" + Clarity	    );
    console.log("Business     :" + Business     );
    console.log("Type	      :" + Type	        );
    console.log("Status       :" + Status       );
    console.log("PM           :" + PM           );
    console.log("Planneddel   :" + Planneddel   );
    console.log("PlannedUAT   :" + PlannedUAT   );
    console.log("PlannedGL    :" + PlannedGL    );
    console.log("Description  :" + Description  );
    console.log("Folder       :" + Folder       );
      }
      function getUrlVars() {
    	var vars = {};
    	var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
    	});
    	return vars;
		}

}
		</script>
	</body>

</html>